services:
  # ==============================
  # FRONTEND (Angular)
  # ==============================
  org-chart-ui:
    build:
      # Path to the Angular folder relative to this file
      context: ./org-chart-ui
      # Specific file to use (optional if named Dockerfile)
      dockerfile: Dockerfile
    container_name: org-chart-ui-app
    ports:
      - "4200:80"
    restart: always
    depends_on:
      - org-chart-api
    
  # ==============================
  # BACKEND (Spring Boot)
  # ==============================
  org-chart-api:
    build:
      context: ./org-chart-api
      dockerfile: Dockerfile
    container_name: org-chart-api-app
    ports:
      - "5001:5001" # Expose API on localhost:8080
    restart: always
    environment:
      # Example: Pass DB credentials here if needed later
      - SPRING_PROFILES_ACTIVE=prod
    depends_on: 
      - mysql-db

  # ==============================
  # DATABASE (MySQL)
  # ==============================
  mysql-db:
    image: mysql:8.4  # Using 8.4 LTS for stability
    container_name: org-chart-db
    environment:
      MYSQL_ROOT_PASSWORD: rootpass
      MYSQL_DATABASE: org-chart
      MYSQL_USER: dbUser
      MYSQL_PASSWORD: dbPassword
    ports:
      - "3306:3306" 
    volumes:
      - mysql-data:/var/lib/mysql
    restart: always
    
  # ==============================
  # DB INTERFACE (phpMyAdmin)
  # ==============================
  db-admin:
    image: phpmyadmin/phpmyadmin
    container_name: mysql-admin-ui
    environment:
      # Point this to the service name of your database
      PMA_HOST: mysql-db
      PMA_PORT: 3306
    ports:
      - "8081:80"     # Access GUI at http://localhost:8081
    depends_on:
      - mysql-db

# Define the volume for persistence
volumes:
  mysql-data: